name: æ¯æ—¥æ–°é—»æ¨é€

# è§¦å‘æ¡ä»¶ï¼šæ¯å¤©æ—©ä¸Š 9 ç‚¹å‡†æ—¶è¿è¡Œ
on:
  schedule:
    # cron è¡¨è¾¾å¼ï¼šåˆ† æ—¶ æ—¥ æœˆ å‘¨
    # 0 9 * * * è¡¨ç¤ºæ¯å¤© 9 ç‚¹ 0 åˆ†è¿è¡Œ
    - cron: '0 9 * * *'
  
  # æ‰‹åŠ¨è§¦å‘ï¼ˆå¯ä»¥åœ¨ GitHub Actions é¡µé¢æ‰‹åŠ¨è¿è¡Œï¼‰
  workflow_dispatch:
  
  # å½“ä»£ç æ¨é€åˆ° main åˆ†æ”¯æ—¶è¿è¡Œ
  push:
    branches: [ main ]

jobs:
  daily-news:
    runs-on: ubuntu-latest  # ä½¿ç”¨ Ubuntu æœ€æ–°ç‰ˆä½œä¸ºè¿è¡Œç¯å¢ƒ
    
    steps:
      # æ­¥éª¤ 1ï¼šæ£€å‡ºä»£ç 
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
      
      # æ­¥éª¤ 2ï¼šè®¾ç½® Python ç¯å¢ƒ
      - name: è®¾ç½® Python 3.x
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'  # ä½¿ç”¨ Python 3.9
          cache: 'pip'  # ç¼“å­˜ pip ä¾èµ–ï¼ŒåŠ é€Ÿè¿è¡Œ
      
      # æ­¥éª¤ 3ï¼šå®‰è£…ä¾èµ–åŒ…
      - name: å®‰è£… Python ä¾èµ–
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      # æ­¥éª¤ 4ï¼šè¿è¡Œæ–°é—»æ¨é€è„šæœ¬
      - name: è¿è¡Œæ¯æ—¥æ–°é—»æ¨é€
        env:
          # ä» GitHub Secrets è¯»å– API å¯†é’¥ï¼ˆå®‰å…¨æ–¹å¼ï¼‰
          TAVILY_API_KEY: ${{ secrets.TAVILY_API_KEY }}
          DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
          # å¾®ä¿¡æµ‹è¯•å·é…ç½®
          WECHAT_APP_ID: ${{ secrets.WECHAT_APP_ID }}
          WECHAT_APP_SECRET: ${{ secrets.WECHAT_APP_SECRET }}
          WECHAT_OPENID: ${{ secrets.WECHAT_OPENID }}
          WECHAT_TEMPLATE_ID: ${{ secrets.WECHAT_TEMPLATE_ID }}
        run: |
          python app.py
        continue-on-error: true  # å³ä½¿å¤±è´¥ä¹Ÿç»§ç»­ï¼ˆä¸ä¼šé˜»æ–­å…¶ä»–å·¥ä½œæµï¼‰
      
      # æ­¥éª¤ 5ï¼šæ·»åŠ æ³¨é‡Šè¯´æ˜ï¼ˆå¯é€‰ï¼‰
      - name: å®Œæˆæç¤º
        if: always()
        run: |
          echo "âœ… GitHub Actions è‡ªåŠ¨è¿è¡Œå®Œæˆ"
          echo "ğŸ“± è¯·æ£€æŸ¥å¾®ä¿¡æ˜¯å¦æ”¶åˆ°æ–°é—»ç®€æŠ¥"
          echo "ğŸ’¡ å¦‚éœ€æŸ¥çœ‹è¿è¡Œæ—¥å¿—ï¼Œè¯·è®¿é—® GitHub Actions é¡µé¢"
